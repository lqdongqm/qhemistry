{{- if eq .Type "search" -}}
{{- $options := dict "ignoreLocation" true -}}
{{- $optionWhitelist := dict
  "ignorelocation" "ignoreLocation"
  "iscasesensitive" "isCaseSensitive"
  "minmatchcharlength" "minMatchCharLength"
  "location" "location"
  "threshold" "threshold"
  "distance" "distance"
  "findallmatches" "findAllMatches"
  "ignorefieldnorm" "ignoreFieldNorm"
  "fieldnormweight" "fieldNormWeight"
-}}
{{- with .Site.Params.search.fuse -}}
  {{- range $key, $value := . -}}
    {{- if isset $optionWhitelist $key -}}
      {{- $options = merge $options (dict (index $optionWhitelist $key) $value) -}}
    {{- end -}}
  {{- end -}}
{{- end -}}

{{- $indexURL := relURL "/search/index.json" -}}
{{- if gt (len $.Site.Home.AllTranslations) 1 -}}
  {{- $indexURL = relLangURL "/search/index.json" -}}
{{- end -}}
{{- $index := resources.Get "search/index.json" | resources.ExecuteAsTemplate $indexURL . -}}

<script>
  window.searchResultContentWordCount = parseInt('{{ default 240 .Site.Params.search.resultContentWordCount }}');
  window.searchPaginate = parseInt('{{ default 10 .Site.Params.search.paginate }}');
  window.fuseOptions = JSON.parse('{{ $options | jsonify | safeHTML }}');
  window.searchIndex = '{{ $index.Permalink }}';
</script>
{{- $options := dict "targetPath" "assets/search/bundle.min.js" "minify" hugo.IsProduction -}}
{{- $script := resources.Get "search/index.ts" | js.Build $options | fingerprint -}}
<script data-precache src="{{ $script.Permalink }}" integrity="{{ $script.Data.Integrity }}" crossorigin="anonymous"></script>
{{- end -}}
